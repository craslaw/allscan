# Configuration for vulnerability scanners

# Global settings
global:
  # Where to clone repos for scanning
  workspace: "/tmp/scanner-workspace"
  
  # Where to store scan results
  results_dir: "./scan-results"
  
  # Vulnerability management system endpoint
  upload_endpoint: "http://192.168.6.167:8080/api/v2/reimport-scan/"
  
  # Maximum concurrent scans
  max_concurrent: 3
  
  # Continue on error or fail fast
  fail_fast: false

# List of scanners to run
scanners:
  - name: "gosec"
    enabled: true
    dojo_scan_type: "Gosec Scanner"  # Required param for Defect Dojo uploads
    command: "gosec"
    args:
      - "-fmt=json"
      - "-out={{output}}"
      - "./..."
    # Only run on Go repositories
    file_patterns:
      - "**/*.go"
      - "go.mod"
    languages:
      - "go"
    timeout: "5m"
    
  - name: "osv-scanner"
    enabled: true
    dojo_scan_type: "OSV Scan"
    command: "osv-scanner"
    args:
      - "scan"
      - "--format"
      - "json"
      - "."
      - "--output"
      - "{{output}}"
    # Universal SCA scanner - runs on all languages (empty = no restrictions)
    languages: []
    timeout: "5m"

  - name: "grype"
    enabled: true
    command: "grype"
    dojo_scan_type: "Anchore Grype"
    args:
      - "."
      - "-o"
      - "json={{output}}"
    # Universal SCA scanner - runs on all languages (empty = no restrictions)
    languages: []
    timeout: "5m"

  - name: "semgrep"
    enabled: false
    dojo_scan_type: "Semgrep Scan"
    command: "semgrep"
    args:
      - "scan"
      - "--config=auto"
      - "--json"
      - "--output={{output}}"
    file_patterns:
      - "**/*.py"
      - "**/*.js"
      - "**/*.go"
      - "**/*.java"
    languages:
      - "python"
      - "javascript"
      - "typescript"
      - "go"
      - "java"
      - "ruby"
      - "php"
      - "c"
      - "cpp"
      - "csharp"
      - "kotlin"
      - "scala"
      - "rust"
      - "swift"
    timeout: "10m"
    
  - name: "trivy"
    enabled: false
    dojo_scan_type: "Trivy Scan"
    command: "trivy"
    args:
      - "fs"
      - "--format=json"
      - "--output={{output}}"
      - "."
    # Run on all repos
    file_patterns: []
    # Universal scanner - runs on all languages (empty = no restrictions)
    languages: []
    timeout: "5m"
    
  - name: "gitleaks"
    enabled: true
    dojo_scan_type: "Gitleaks Scan"
    command: "gitleaks"
    args:
      - "detect"
      - "--source=."
      - "--report-format=json"
      - "--report-path={{output}}"
      - "--no-git"
    # Local mode: respect .gitignore by not using --no-git
    args_local:
      - "detect"
      - "--source=."
      - "--report-format=json"
      - "--report-path={{output}}"
    file_patterns: []
    # Universal secrets scanner - runs on all languages (empty = no restrictions)
    languages: []
    timeout: "3m"

  - name: "binary-detector"
    enabled: true
    dojo_scan_type: "Generic Findings Import"
    command: "builtin:binary-detector"  # Built-in scanner, no external binary needed
    args: []
    file_patterns: []
    # Universal scanner - runs on all repos (empty = no restrictions)
    languages: []
    timeout: "5m"

  - name: "golangci-lint"
    enabled: false  # Disabled by default
    dojo_scan_type: "Golangci-lint"
    command: "golangci-lint"
    args:
      - "run"
      - "--out-format=json"
      - "--issues-exit-code=0"
    file_patterns:
      - "**/*.go"
      - "go.mod"
    languages:
      - "go"
    timeout: "10m"

  - name: "scorecard"
    enabled: true
    # No dojo_scan_type - this scanner outputs to stdout only, never uploads
    command: "scorecard"
    args:
      - "--repo={{repo}}"
      - "--format=json"
      - "--output={{output}}"
    args_local:
      - "--local=."
      - "--format=json"
      - "--output={{output}}"
    file_patterns: []
    # Universal scanner - runs on all repos (empty = no restrictions)
    languages: []
    timeout: "5m"
    required_env:
      - "GITHUB_TOKEN"

  - name: "socket"
    enabled: false  # Disabled by default - requires Socket API token
    dojo_scan_type: "Generic Findings Import"  # No native DefectDojo parser yet
    command: "socket"
    args:
      - "scan"
      - "create"
      - "."
      - "--json"
      - "--file={{output}}"
    file_patterns: []
    # Universal SCA scanner - supports npm, pip, go, gems, etc.
    languages: []
    timeout: "10m"
    required_env:
      - "SOCKET_SECURITY_API_TOKEN"
